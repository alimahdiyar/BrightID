{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.setActiveDevices = exports.selectAllDevices = exports.selectActiveDevices = exports.removeDevice = exports.default = exports.addDevice = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _toolkit = require(\"@reduxjs/toolkit\");\n\nvar _resetStore = require(\"../actions/resetStore\");\n\nvar devicesAdapter = (0, _toolkit.createEntityAdapter)({\n  selectId: function selectId(device) {\n    return device.signingKey;\n  }\n});\nvar devicesSlice = (0, _toolkit.createSlice)({\n  name: 'devices',\n  initialState: devicesAdapter.getInitialState(),\n  reducers: {\n    addDevice: devicesAdapter.upsertOne,\n    removeDevice: devicesAdapter.removeOne,\n    setActiveDevices: function setActiveDevices(state, action) {\n      console.log('updating devices based on server state');\n      devicesAdapter.updateMany(state, state.ids.map(function (signingKey) {\n        var active = action.payload.indexOf(signingKey) > -1;\n        return {\n          id: signingKey,\n          changes: {\n            active: active\n          }\n        };\n      }));\n      var newDevices = action.payload.filter(function (id) {\n        return !state.ids.includes(id);\n      });\n      devicesAdapter.addMany(state, newDevices.map(function (signingKey) {\n        return {\n          signingKey: signingKey,\n          active: true,\n          name: 'Unknown'\n        };\n      }));\n    }\n  },\n  extraReducers: (0, _defineProperty2.default)({}, _resetStore.RESET_STORE, function () {\n    return devicesAdapter.getInitialState();\n  })\n});\nvar _devicesSlice$actions = devicesSlice.actions,\n    addDevice = _devicesSlice$actions.addDevice,\n    removeDevice = _devicesSlice$actions.removeDevice,\n    setActiveDevices = _devicesSlice$actions.setActiveDevices;\nexports.setActiveDevices = setActiveDevices;\nexports.removeDevice = removeDevice;\nexports.addDevice = addDevice;\n\nvar _devicesAdapter$getSe = devicesAdapter.getSelectors(function (state) {\n  return state.devices;\n}),\n    selectAllDevices = _devicesAdapter$getSe.selectAll;\n\nexports.selectAllDevices = selectAllDevices;\nvar selectActiveDevices = (0, _toolkit.createSelector)(selectAllDevices, function (devices) {\n  return devices.filter(function (d) {\n    return d == null ? void 0 : d.active;\n  });\n});\nexports.selectActiveDevices = selectActiveDevices;\nvar _default = devicesSlice.reducer;\nexports.default = _default;","map":{"version":3,"names":["devicesAdapter","createEntityAdapter","selectId","device","signingKey","devicesSlice","createSlice","name","initialState","getInitialState","reducers","addDevice","upsertOne","removeDevice","removeOne","setActiveDevices","state","action","console","log","updateMany","ids","map","active","payload","indexOf","id","changes","newDevices","filter","includes","addMany","extraReducers","RESET_STORE","actions","getSelectors","devices","selectAllDevices","selectAll","selectActiveDevices","createSelector","d","reducer"],"sources":["/home/ali/Desktop/brightid/BrightID/BrightID/src/reducer/devicesSlice.ts"],"sourcesContent":["import {\n  createSlice,\n  PayloadAction,\n  createEntityAdapter,\n  createSelector,\n} from '@reduxjs/toolkit';\nimport { RESET_STORE } from '@/actions/resetStore';\n\nconst devicesAdapter = createEntityAdapter<Device>({\n  selectId: (device) => device.signingKey,\n});\n\nconst devicesSlice = createSlice({\n  name: 'devices',\n  initialState: devicesAdapter.getInitialState(),\n  reducers: {\n    addDevice: devicesAdapter.upsertOne,\n    removeDevice: devicesAdapter.removeOne,\n    setActiveDevices: (state, action: PayloadAction<string[]>) => {\n      console.log('updating devices based on server state');\n      // update existing devices\n      devicesAdapter.updateMany(\n        state,\n        state.ids.map((signingKey: string) => {\n          const active = action.payload.indexOf(signingKey) > -1;\n          return { id: signingKey, changes: { active } };\n        }),\n      );\n      // add new devices\n      const newDevices = action.payload.filter((id) => !state.ids.includes(id));\n      devicesAdapter.addMany(\n        state,\n        newDevices.map((signingKey) => {\n          return { signingKey, active: true, name: 'Unknown' };\n        }),\n      );\n    },\n  },\n  extraReducers: {\n    [RESET_STORE]: () => {\n      return devicesAdapter.getInitialState();\n    },\n  },\n});\n\n// Export channel actions\nexport const { addDevice, removeDevice, setActiveDevices } =\n  devicesSlice.actions;\n\n// export selectors\nexport const { selectAll: selectAllDevices } = devicesAdapter.getSelectors(\n  (state: State) => state.devices,\n);\n\nexport const selectActiveDevices = createSelector(\n  selectAllDevices,\n  (devices) => {\n    return devices.filter((d) => d?.active);\n  },\n);\n\n// Export reducer\nexport default devicesSlice.reducer;\n"],"mappings":";;;;;;;;;AAAA;;AAMA;;AAEA,IAAMA,cAAc,GAAG,IAAAC,4BAAA,EAA4B;EACjDC,QAAQ,EAAE,kBAACC,MAAD;IAAA,OAAYA,MAAM,CAACC,UAAnB;EAAA;AADuC,CAA5B,CAAvB;AAIA,IAAMC,YAAY,GAAG,IAAAC,oBAAA,EAAY;EAC/BC,IAAI,EAAE,SADyB;EAE/BC,YAAY,EAAER,cAAc,CAACS,eAAf,EAFiB;EAG/BC,QAAQ,EAAE;IACRC,SAAS,EAAEX,cAAc,CAACY,SADlB;IAERC,YAAY,EAAEb,cAAc,CAACc,SAFrB;IAGRC,gBAAgB,EAAE,0BAACC,KAAD,EAAQC,MAAR,EAA4C;MAC5DC,OAAO,CAACC,GAAR,CAAY,wCAAZ;MAEAnB,cAAc,CAACoB,UAAf,CACEJ,KADF,EAEEA,KAAK,CAACK,GAAN,CAAUC,GAAV,CAAc,UAAClB,UAAD,EAAwB;QACpC,IAAMmB,MAAM,GAAGN,MAAM,CAACO,OAAP,CAAeC,OAAf,CAAuBrB,UAAvB,IAAqC,CAAC,CAArD;QACA,OAAO;UAAEsB,EAAE,EAAEtB,UAAN;UAAkBuB,OAAO,EAAE;YAAEJ,MAAM,EAANA;UAAF;QAA3B,CAAP;MACD,CAHD,CAFF;MAQA,IAAMK,UAAU,GAAGX,MAAM,CAACO,OAAP,CAAeK,MAAf,CAAsB,UAACH,EAAD;QAAA,OAAQ,CAACV,KAAK,CAACK,GAAN,CAAUS,QAAV,CAAmBJ,EAAnB,CAAT;MAAA,CAAtB,CAAnB;MACA1B,cAAc,CAAC+B,OAAf,CACEf,KADF,EAEEY,UAAU,CAACN,GAAX,CAAe,UAAClB,UAAD,EAAgB;QAC7B,OAAO;UAAEA,UAAU,EAAVA,UAAF;UAAcmB,MAAM,EAAE,IAAtB;UAA4BhB,IAAI,EAAE;QAAlC,CAAP;MACD,CAFD,CAFF;IAMD;EArBO,CAHqB;EA0B/ByB,aAAa,oCACVC,uBADU,EACI,YAAM;IACnB,OAAOjC,cAAc,CAACS,eAAf,EAAP;EACD,CAHU;AA1BkB,CAAZ,CAArB;AAkCO,4BACLJ,YAAY,CAAC6B,OADR;AAAA,IAAQvB,SAAR,yBAAQA,SAAR;AAAA,IAAmBE,YAAnB,yBAAmBA,YAAnB;AAAA,IAAiCE,gBAAjC,yBAAiCA,gBAAjC;;;;;AAIA,4BAAwCf,cAAc,CAACmC,YAAf,CAC7C,UAACnB,KAAD;EAAA,OAAkBA,KAAK,CAACoB,OAAxB;AAAA,CAD6C,CAAxC;AAAA,IAAmBC,gBAAnB,yBAAQC,SAAR;;;AAIA,IAAMC,mBAAmB,GAAG,IAAAC,uBAAA,EACjCH,gBADiC,EAEjC,UAACD,OAAD,EAAa;EACX,OAAOA,OAAO,CAACP,MAAR,CAAe,UAACY,CAAD;IAAA,OAAOA,CAAP,oBAAOA,CAAC,CAAElB,MAAV;EAAA,CAAf,CAAP;AACD,CAJgC,CAA5B;;eAQQlB,YAAY,CAACqC,O"},"metadata":{},"sourceType":"script"}