{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createAnimatedEvent = createAnimatedEvent;\nexports.default = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _reactNative = require(\"react-native\");\n\nvar _ReanimatedModule = _interopRequireDefault(require(\"../ReanimatedModule\"));\n\nvar _AnimatedNode2 = _interopRequireDefault(require(\"./AnimatedNode\"));\n\nvar _AnimatedValue = _interopRequireDefault(require(\"./AnimatedValue\"));\n\nvar _AnimatedAlways = require(\"./AnimatedAlways\");\n\nvar _invariant = _interopRequireDefault(require(\"fbjs/lib/invariant\"));\n\nvar _createEventObjectProxyPolyfill = _interopRequireDefault(require(\"./createEventObjectProxyPolyfill\"));\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction sanitizeArgMapping(argMapping) {\n  var eventMappings = [];\n  var alwaysNodes = [];\n\n  var getNode = function getNode(node) {\n    if (_reactNative.Platform.OS === 'web' || _reactNative.Platform.OS === 'windows' || _reactNative.Platform.OS === 'macos') {\n      return node;\n    }\n\n    return node.__nodeID;\n  };\n\n  var traverse = function traverse(value, path) {\n    if (value instanceof _AnimatedValue.default) {\n      eventMappings.push(path.concat(getNode(value)));\n    } else if (typeof value === 'object' && value.__val) {\n      eventMappings.push(path.concat(getNode(value.__val)));\n    } else if (typeof value === 'function') {\n      var node = new _AnimatedValue.default(0);\n      alwaysNodes.push((0, _AnimatedAlways.createAnimatedAlways)(value(node)));\n      eventMappings.push(path.concat(getNode(node)));\n    } else if (typeof value === 'object') {\n      for (var key in value) {\n        traverse(value[key], path.concat(key));\n      }\n    }\n  };\n\n  (0, _invariant.default)(argMapping[0] && argMapping[0].nativeEvent, 'Native driven events only support animated values contained inside `nativeEvent`.');\n  var ev = argMapping[0].nativeEvent;\n\n  if (typeof ev === 'object') {\n    traverse(ev, []);\n  } else if (typeof ev === 'function') {\n    var proxyHandler = {\n      get: function get(target, name) {\n        if (name === '__isProxy') {\n          return true;\n        }\n\n        if (!target[name] && name !== '__val') {\n          target[name] = new Proxy({}, proxyHandler);\n        }\n\n        return target[name];\n      },\n      set: function set(target, prop, value) {\n        if (prop === '__val') {\n          target[prop] = value;\n          return true;\n        }\n\n        return false;\n      }\n    };\n    var proxy = typeof Proxy === 'function' ? new Proxy({}, proxyHandler) : (0, _createEventObjectProxyPolyfill.default)();\n    alwaysNodes.push((0, _AnimatedAlways.createAnimatedAlways)(ev(proxy)));\n    traverse(proxy, []);\n  }\n\n  return {\n    eventMappings: eventMappings,\n    alwaysNodes: alwaysNodes\n  };\n}\n\nvar AnimatedEvent = function (_AnimatedNode) {\n  (0, _inherits2.default)(AnimatedEvent, _AnimatedNode);\n\n  var _super = _createSuper(AnimatedEvent);\n\n  function AnimatedEvent(argMapping) {\n    var _this;\n\n    var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    (0, _classCallCheck2.default)(this, AnimatedEvent);\n\n    var _sanitizeArgMapping = sanitizeArgMapping(argMapping),\n        eventMappings = _sanitizeArgMapping.eventMappings,\n        alwaysNodes = _sanitizeArgMapping.alwaysNodes;\n\n    _this = _super.call(this, {\n      type: 'event',\n      argMapping: eventMappings\n    });\n\n    _defineProperty((0, _assertThisInitialized2.default)(_this), \"__isNative\", true);\n\n    _this._alwaysNodes = alwaysNodes;\n    return _this;\n  }\n\n  (0, _createClass2.default)(AnimatedEvent, [{\n    key: \"toString\",\n    value: function toString() {\n      return \"AnimatedEvent, id: \".concat(this.__nodeID);\n    }\n  }, {\n    key: \"attachEvent\",\n    value: function attachEvent(viewRef, eventName) {\n      for (var i = 0; i < this._alwaysNodes.length; i++) {\n        this._alwaysNodes[i].__attach();\n      }\n\n      this.__attach();\n\n      var viewTag = (0, _reactNative.findNodeHandle)(viewRef);\n\n      _ReanimatedModule.default.attachEvent(viewTag, eventName, this.__nodeID);\n    }\n  }, {\n    key: \"__onEvaluate\",\n    value: function __onEvaluate() {\n      return 0;\n    }\n  }, {\n    key: \"detachEvent\",\n    value: function detachEvent(viewRef, eventName) {\n      for (var i = 0; i < this._alwaysNodes.length; i++) {\n        this._alwaysNodes[i].isNativelyInitialized() && this._alwaysNodes[i].__detach();\n      }\n\n      var viewTag = (0, _reactNative.findNodeHandle)(viewRef);\n\n      _ReanimatedModule.default.detachEvent(viewTag, eventName, this.__nodeID);\n\n      this.__detach();\n    }\n  }]);\n  return AnimatedEvent;\n}(_AnimatedNode2.default);\n\nexports.default = AnimatedEvent;\n\nfunction createAnimatedEvent(argMapping, config) {\n  return new AnimatedEvent(argMapping, config);\n}","map":{"version":3,"sources":["AnimatedEvent.js"],"names":["eventMappings","alwaysNodes","getNode","node","Platform","traverse","value","path","createAnimatedAlways","invariant","argMapping","ev","proxyHandler","get","name","target","set","prop","proxy","constructor","config","sanitizeArgMapping","type","toString","attachEvent","i","viewTag","findNodeHandle","ReanimatedModule","__onEvaluate","detachEvent"],"mappings":"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","sourcesContent":["import { Platform, findNodeHandle } from 'react-native';\nimport ReanimatedModule from '../ReanimatedModule';\n\nimport AnimatedNode from './AnimatedNode';\nimport InternalAnimatedValue from './AnimatedValue';\nimport { createAnimatedAlways } from './AnimatedAlways';\n\nimport invariant from 'fbjs/lib/invariant';\nimport createEventObjectProxyPolyfill from './createEventObjectProxyPolyfill';\n\nfunction sanitizeArgMapping(argMapping) {\n  // Find animated values in `argMapping` and create an array representing their\n  // key path inside the `nativeEvent` object. Ex.: ['contentOffset', 'x'].\n  const eventMappings = [];\n  const alwaysNodes = [];\n\n  const getNode = node => {\n    if (Platform.OS === 'web' || Platform.OS === 'windows' || Platform.OS === 'macos') {\n      return node;\n    }\n    return node.__nodeID;\n  };\n\n  const traverse = (value, path) => {\n    if (value instanceof InternalAnimatedValue) {\n      eventMappings.push(path.concat(getNode(value)));\n    } else if (typeof value === 'object' && value.__val) {\n      eventMappings.push(path.concat(getNode(value.__val)));\n    } else if (typeof value === 'function') {\n      const node = new InternalAnimatedValue(0);\n      alwaysNodes.push(createAnimatedAlways(value(node)));\n      eventMappings.push(path.concat(getNode(node)));\n    } else if (typeof value === 'object') {\n      for (const key in value) {\n        traverse(value[key], path.concat(key));\n      }\n    }\n  };\n\n  invariant(\n    argMapping[0] && argMapping[0].nativeEvent,\n    'Native driven events only support animated values contained inside `nativeEvent`.'\n  );\n\n  // Assume that the event containing `nativeEvent` is always the first argument.\n  const ev = argMapping[0].nativeEvent;\n  if (typeof ev === 'object') {\n    traverse(ev, []);\n  } else if (typeof ev === 'function') {\n    const proxyHandler = {\n      get: function(target, name) {\n        if (name === '__isProxy') {\n          return true;\n        }\n        if (!target[name] && name !== '__val') {\n          target[name] = new Proxy({}, proxyHandler);\n        }\n        return target[name];\n      },\n      set: function(target, prop, value) {\n        if (prop === '__val') {\n          target[prop] = value;\n          return true;\n        }\n        return false;\n      },\n    };\n\n    const proxy =\n      typeof Proxy === 'function'\n        ? new Proxy({}, proxyHandler)\n        : createEventObjectProxyPolyfill();\n    alwaysNodes.push(createAnimatedAlways(ev(proxy)));\n    traverse(proxy, []);\n  }\n\n  return { eventMappings, alwaysNodes };\n}\n\nexport default class AnimatedEvent extends AnimatedNode {\n  constructor(argMapping, config = {}) {\n    const { eventMappings, alwaysNodes } = sanitizeArgMapping(argMapping);\n    super({ type: 'event', argMapping: eventMappings });\n    this._alwaysNodes = alwaysNodes;\n  }\n\n  toString() {\n    return `AnimatedEvent, id: ${this.__nodeID}`;\n  }\n\n  // The below field is a temporary workaround to make AnimatedEvent object be recognized\n  // as Animated.event event callback and therefore filtered out from being send over the\n  // bridge which was causing the object to be frozen in JS.\n  __isNative = true;\n\n  attachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].__attach();\n    }\n    this.__attach();\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.attachEvent(viewTag, eventName, this.__nodeID);\n  }\n\n  __onEvaluate() {\n    return 0;\n  }\n\n  detachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].isNativelyInitialized() &&\n        this._alwaysNodes[i].__detach();\n    }\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.detachEvent(viewTag, eventName, this.__nodeID);\n    this.__detach();\n  }\n}\n\nexport function createAnimatedEvent(argMapping, config) {\n  return new AnimatedEvent(argMapping, config);\n}\n"]},"metadata":{},"sourceType":"script"}