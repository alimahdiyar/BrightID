{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.upsertSig = exports.updateSig = exports.updateLinkedContext = exports.setApps = exports.selectPendingLinkedContext = exports.selectLinkedContextById = exports.selectLinkedContext = exports.selectExpireableBlindSigApps = exports.selectBlindSigApps = exports.selectAllSigs = exports.selectAllLinkedSigs = exports.selectAllLinkedContexts = exports.selectAllApps = exports.removeSig = exports.removeLinkedContext = exports.removeAllSigs = exports.linkedContextTotal = exports.default = exports.createSelectLinkedSigsForApp = exports.addLinkedContext = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _toolkit = require(\"@reduxjs/toolkit\");\n\nvar _resetStore = require(\"../actions/resetStore\");\n\nvar linkedContextsAdapter = (0, _toolkit.createEntityAdapter)({\n  selectId: function selectId(linkedContext) {\n    return linkedContext.contextId;\n  }\n});\nvar sigsAdapter = (0, _toolkit.createEntityAdapter)({\n  selectId: function selectId(sig) {\n    return \"\" + sig.uid;\n  }\n});\nvar initialState = {\n  apps: [],\n  linkedContexts: linkedContextsAdapter.getInitialState(),\n  sigs: sigsAdapter.getInitialState()\n};\nvar appsSlice = (0, _toolkit.createSlice)({\n  name: 'apps',\n  initialState: initialState,\n  reducers: {\n    setApps: function setApps(state, action) {\n      state.apps = action.payload;\n    },\n    addLinkedContext: function addLinkedContext(state, action) {\n      state.linkedContexts = linkedContextsAdapter.addOne(state.linkedContexts, action);\n    },\n    removeLinkedContext: function removeLinkedContext(state, action) {\n      state.linkedContexts = linkedContextsAdapter.removeOne(state.linkedContexts, action);\n    },\n    updateLinkedContext: function updateLinkedContext(state, action) {\n      var update = {\n        id: action.payload.contextId,\n        changes: action.payload\n      };\n      state.linkedContexts = linkedContextsAdapter.updateOne(state.linkedContexts, update);\n    },\n    upsertSig: function upsertSig(state, action) {\n      state.sigs = sigsAdapter.upsertOne(state.sigs, action);\n    },\n    removeSig: function removeSig(state, action) {\n      state.sigs = sigsAdapter.removeOne(state.sigs, action);\n    },\n    removeAllSigs: function removeAllSigs(state) {\n      state.sigs = sigsAdapter.removeAll(state.sigs);\n    },\n    updateSig: function updateSig(state, action) {\n      state.sigs = sigsAdapter.updateOne(state.sigs, action.payload);\n    }\n  },\n  extraReducers: (0, _defineProperty2.default)({}, _resetStore.RESET_STORE, function () {\n    return initialState;\n  })\n});\nvar _appsSlice$actions = appsSlice.actions,\n    setApps = _appsSlice$actions.setApps,\n    addLinkedContext = _appsSlice$actions.addLinkedContext,\n    removeLinkedContext = _appsSlice$actions.removeLinkedContext,\n    updateLinkedContext = _appsSlice$actions.updateLinkedContext,\n    upsertSig = _appsSlice$actions.upsertSig,\n    removeSig = _appsSlice$actions.removeSig,\n    removeAllSigs = _appsSlice$actions.removeAllSigs,\n    updateSig = _appsSlice$actions.updateSig;\nexports.updateSig = updateSig;\nexports.removeAllSigs = removeAllSigs;\nexports.removeSig = removeSig;\nexports.upsertSig = upsertSig;\nexports.updateLinkedContext = updateLinkedContext;\nexports.removeLinkedContext = removeLinkedContext;\nexports.addLinkedContext = addLinkedContext;\nexports.setApps = setApps;\n\nvar _linkedContextsAdapte = linkedContextsAdapter.getSelectors(function (state) {\n  return state.apps.linkedContexts;\n}),\n    selectLinkedContextById = _linkedContextsAdapte.selectById,\n    selectAllLinkedContexts = _linkedContextsAdapte.selectAll;\n\nexports.selectAllLinkedContexts = selectAllLinkedContexts;\nexports.selectLinkedContextById = selectLinkedContextById;\n\nvar _sigsAdapter$getSelec = sigsAdapter.getSelectors(function (state) {\n  return state.apps.sigs;\n}),\n    selectAllSigs = _sigsAdapter$getSelec.selectAll;\n\nexports.selectAllSigs = selectAllSigs;\nvar linkedContextTotal = (0, _toolkit.createSelector)(selectAllLinkedContexts, function (contexts) {\n  return contexts.reduce(function (acc, link) {\n    return link.state === 'applied' ? acc + 1 : acc;\n  }, 0);\n});\nexports.linkedContextTotal = linkedContextTotal;\nvar selectLinkedContext = (0, _toolkit.createSelector)(selectAllLinkedContexts, function (_, context) {\n  return context;\n}, function (contexts, context) {\n  return contexts.find(function (link) {\n    return link.context === context;\n  });\n});\nexports.selectLinkedContext = selectLinkedContext;\nvar selectPendingLinkedContext = (0, _toolkit.createSelector)(selectAllLinkedContexts, function (contexts) {\n  return contexts.find(function (link) {\n    return link.state === 'pending';\n  });\n});\nexports.selectPendingLinkedContext = selectPendingLinkedContext;\n\nvar selectAllApps = function selectAllApps(state) {\n  return state.apps.apps;\n};\n\nexports.selectAllApps = selectAllApps;\nvar selectAllLinkedSigs = (0, _toolkit.createSelector)(selectAllSigs, function (sigs) {\n  return sigs.filter(function (sig) {\n    return sig.linked;\n  });\n});\nexports.selectAllLinkedSigs = selectAllLinkedSigs;\n\nvar createSelectLinkedSigsForApp = function createSelectLinkedSigsForApp(appId) {\n  return (0, _toolkit.createSelector)(selectAllLinkedSigs, function (linkedSigs) {\n    return linkedSigs.filter(function (sig) {\n      return sig.app === appId;\n    });\n  });\n};\n\nexports.createSelectLinkedSigsForApp = createSelectLinkedSigsForApp;\n\nvar selectBlindSigApps = function selectBlindSigApps(state) {\n  return state.apps.apps.filter(function (app) {\n    return app.usingBlindSig;\n  });\n};\n\nexports.selectBlindSigApps = selectBlindSigApps;\nvar selectExpireableBlindSigApps = (0, _toolkit.createSelector)(selectBlindSigApps, function (apps) {\n  return apps.filter(function (app) {\n    return app.verificationExpirationLength;\n  });\n});\nexports.selectExpireableBlindSigApps = selectExpireableBlindSigApps;\nvar _default = appsSlice.reducer;\nexports.default = _default;","map":{"version":3,"names":["linkedContextsAdapter","createEntityAdapter","selectId","linkedContext","contextId","sigsAdapter","sig","uid","initialState","apps","linkedContexts","getInitialState","sigs","appsSlice","createSlice","name","reducers","setApps","state","action","payload","addLinkedContext","addOne","removeLinkedContext","removeOne","updateLinkedContext","update","id","changes","updateOne","upsertSig","upsertOne","removeSig","removeAllSigs","removeAll","updateSig","extraReducers","RESET_STORE","actions","getSelectors","selectLinkedContextById","selectById","selectAllLinkedContexts","selectAll","selectAllSigs","linkedContextTotal","createSelector","contexts","reduce","acc","link","selectLinkedContext","_","context","find","selectPendingLinkedContext","selectAllApps","selectAllLinkedSigs","filter","linked","createSelectLinkedSigsForApp","appId","linkedSigs","app","selectBlindSigApps","usingBlindSig","selectExpireableBlindSigApps","verificationExpirationLength","reducer"],"sources":["/home/ali/Desktop/brightid/BrightID/BrightID/src/reducer/appsSlice.ts"],"sourcesContent":["import {\n  createSelector,\n  createSlice,\n  createEntityAdapter,\n  PayloadAction,\n  Update,\n} from '@reduxjs/toolkit';\nimport { RESET_STORE } from '@/actions/resetStore';\n\n/* ******** INITIAL STATE ************** */\n\nconst linkedContextsAdapter = createEntityAdapter<ContextInfo>({\n  selectId: (linkedContext) => linkedContext.contextId,\n});\n\nconst sigsAdapter = createEntityAdapter<SigInfo>({\n  selectId: (sig) => `${sig.uid}`,\n});\n\nconst initialState: AppsState = {\n  apps: [],\n  linkedContexts: linkedContextsAdapter.getInitialState(),\n  sigs: sigsAdapter.getInitialState(),\n};\n\nconst appsSlice = createSlice({\n  name: 'apps',\n  initialState,\n  reducers: {\n    setApps(state, action: PayloadAction<AppInfo[]>) {\n      state.apps = action.payload;\n    },\n    addLinkedContext(state, action: PayloadAction<ContextInfo>) {\n      state.linkedContexts = linkedContextsAdapter.addOne(\n        state.linkedContexts,\n        action,\n      );\n    },\n    removeLinkedContext(state, action: PayloadAction<string>) {\n      state.linkedContexts = linkedContextsAdapter.removeOne(\n        state.linkedContexts,\n        action,\n      );\n    },\n    updateLinkedContext(state, action: PayloadAction<Partial<ContextInfo>>) {\n      const update: Update<ContextInfo> = {\n        id: action.payload.contextId,\n        changes: action.payload,\n      };\n      state.linkedContexts = linkedContextsAdapter.updateOne(\n        state.linkedContexts,\n        update,\n      );\n    },\n    upsertSig(state, action: PayloadAction<SigInfo>) {\n      state.sigs = sigsAdapter.upsertOne(state.sigs, action);\n    },\n    removeSig(state, action: PayloadAction<string>) {\n      state.sigs = sigsAdapter.removeOne(state.sigs, action);\n    },\n    removeAllSigs(state) {\n      state.sigs = sigsAdapter.removeAll(state.sigs);\n    },\n    updateSig(state, action: PayloadAction<Update<SigInfo>>) {\n      state.sigs = sigsAdapter.updateOne(state.sigs, action.payload);\n    },\n  },\n  extraReducers: {\n    [RESET_STORE]: () => {\n      return initialState;\n    },\n  },\n});\n\n// Export app actions\nexport const {\n  setApps,\n  addLinkedContext,\n  removeLinkedContext,\n  updateLinkedContext,\n  upsertSig,\n  removeSig,\n  removeAllSigs,\n  updateSig,\n} = appsSlice.actions;\n\nexport const {\n  selectById: selectLinkedContextById,\n  selectAll: selectAllLinkedContexts,\n} = linkedContextsAdapter.getSelectors(\n  (state: State) => state.apps.linkedContexts,\n);\n\nexport const { selectAll: selectAllSigs } = sigsAdapter.getSelectors(\n  (state: State) => state.apps.sigs,\n);\n\nexport const linkedContextTotal = createSelector(\n  selectAllLinkedContexts,\n  (contexts) =>\n    contexts.reduce(\n      (acc, link) => (link.state === 'applied' ? acc + 1 : acc),\n      0,\n    ),\n);\n\nexport const selectLinkedContext = createSelector(\n  selectAllLinkedContexts,\n  (_: State, context: string) => context,\n  (contexts, context) => contexts.find((link) => link.context === context),\n);\n\nexport const selectPendingLinkedContext = createSelector(\n  selectAllLinkedContexts,\n  (contexts) => contexts.find((link) => link.state === 'pending'),\n);\n\nexport const selectAllApps = (state: State) => state.apps.apps;\n\nexport const selectAllLinkedSigs = createSelector(selectAllSigs, (sigs) =>\n  sigs.filter((sig) => sig.linked),\n);\n\nexport const createSelectLinkedSigsForApp = (appId) =>\n  createSelector(selectAllLinkedSigs, (linkedSigs) => {\n    // return all linked sigs that belong to provided app\n    return linkedSigs.filter((sig) => sig.app === appId);\n  });\n\nexport const selectBlindSigApps = (state: State) =>\n  state.apps.apps.filter((app) => app.usingBlindSig);\n\nexport const selectExpireableBlindSigApps = createSelector(\n  selectBlindSigApps,\n  (apps) => apps.filter((app) => app.verificationExpirationLength),\n);\n\n// Export reducer\nexport default appsSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}