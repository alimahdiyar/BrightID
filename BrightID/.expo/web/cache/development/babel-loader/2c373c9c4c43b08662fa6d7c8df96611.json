{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.updateChannel = exports.setMyChannel = exports.setDisplayChannelType = exports.selectChannelById = exports.selectAllChannels = exports.selectAllChannelIds = exports.selectAllActiveChannelIdsByType = exports.selectAllActiveChannelIds = exports.removeChannel = exports.default = exports.closeChannel = exports.channelsAdapter = exports.channel_types = exports.channel_states = exports.addChannel = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _toolkit = require(\"@reduxjs/toolkit\");\n\nvar _myChannelIds;\n\nvar channel_types;\nexports.channel_types = channel_types;\n\n(function (channel_types) {\n  channel_types[\"GROUP\"] = \"GROUP\";\n  channel_types[\"SINGLE\"] = \"SINGLE\";\n  channel_types[\"STAR\"] = \"STAR\";\n})(channel_types || (exports.channel_types = channel_types = {}));\n\nvar channel_states;\nexports.channel_states = channel_states;\n\n(function (channel_states) {\n  channel_states[\"OPEN\"] = \"OPEN\";\n  channel_states[\"CLOSED\"] = \"CLOSED\";\n  channel_states[\"BACKGROUND\"] = \"BACKGROUND\";\n})(channel_states || (exports.channel_states = channel_states = {}));\n\nvar channelsAdapter = (0, _toolkit.createEntityAdapter)();\nexports.channelsAdapter = channelsAdapter;\nvar initialState = channelsAdapter.getInitialState({\n  displayChannelType: channel_types.SINGLE,\n  myChannelIds: (_myChannelIds = {}, (0, _defineProperty2.default)(_myChannelIds, channel_types.SINGLE, ''), (0, _defineProperty2.default)(_myChannelIds, channel_types.GROUP, ''), (0, _defineProperty2.default)(_myChannelIds, channel_types.STAR, ''), _myChannelIds)\n});\nvar channelSlice = (0, _toolkit.createSlice)({\n  name: 'channels',\n  initialState: initialState,\n  reducers: {\n    addChannel: function addChannel(state, action) {\n      state = channelsAdapter.addOne(state, action);\n    },\n    updateChannel: function updateChannel(state, action) {\n      state = channelsAdapter.updateOne(state, action);\n    },\n    closeChannel: function closeChannel(state, action) {\n      var _action$payload = action.payload,\n          channelId = _action$payload.channelId,\n          background = _action$payload.background;\n      state = channelsAdapter.updateOne(state, {\n        id: channelId,\n        changes: {\n          state: background ? channel_states.BACKGROUND : channel_states.CLOSED\n        }\n      });\n      if (state.myChannelIds[channel_types.SINGLE] === channelId) state.myChannelIds[channel_types.SINGLE] = '';\n      if (state.myChannelIds[channel_types.GROUP] === channelId) state.myChannelIds[channel_types.GROUP] = '';\n      if (state.myChannelIds[channel_types.STAR] === channelId) state.myChannelIds[channel_types.STAR] = '';\n    },\n    removeChannel: function removeChannel(state, action) {\n      var channelId = action.payload;\n      state = channelsAdapter.removeOne(state, channelId);\n      if (state.myChannelIds[channel_types.SINGLE] === channelId) state.myChannelIds[channel_types.SINGLE] === '';\n      if (state.myChannelIds[channel_types.GROUP] === channelId) state.myChannelIds[channel_types.GROUP] === '';\n      if (state.myChannelIds[channel_types.STAR] === channelId) state.myChannelIds[channel_types.STAR] = '';\n    },\n    setMyChannel: function setMyChannel(state, action) {\n      var _action$payload2 = action.payload,\n          channelType = _action$payload2.channelType,\n          channelId = _action$payload2.channelId;\n      state.myChannelIds[channelType] = channelId;\n    },\n    setDisplayChannelType: function setDisplayChannelType(state, action) {\n      var channelType = action.payload;\n      state.displayChannelType = channelType;\n    }\n  }\n});\nvar _channelSlice$actions = channelSlice.actions,\n    addChannel = _channelSlice$actions.addChannel,\n    updateChannel = _channelSlice$actions.updateChannel,\n    removeChannel = _channelSlice$actions.removeChannel,\n    setMyChannel = _channelSlice$actions.setMyChannel,\n    closeChannel = _channelSlice$actions.closeChannel,\n    setDisplayChannelType = _channelSlice$actions.setDisplayChannelType;\nexports.setDisplayChannelType = setDisplayChannelType;\nexports.closeChannel = closeChannel;\nexports.setMyChannel = setMyChannel;\nexports.removeChannel = removeChannel;\nexports.updateChannel = updateChannel;\nexports.addChannel = addChannel;\n\nvar _channelsAdapter$getS = channelsAdapter.getSelectors(function (state) {\n  return state.channels;\n}),\n    selectChannelById = _channelsAdapter$getS.selectById,\n    selectAllChannels = _channelsAdapter$getS.selectAll,\n    selectAllChannelIds = _channelsAdapter$getS.selectIds;\n\nexports.selectAllChannelIds = selectAllChannelIds;\nexports.selectAllChannels = selectAllChannels;\nexports.selectChannelById = selectChannelById;\nvar selectAllActiveChannelIds = (0, _toolkit.createSelector)(selectAllChannels, function (_, type) {\n  return type;\n}, function (channels, type) {\n  return channels.filter(function (pc) {\n    return pc.type === type;\n  }).map(function (pc) {\n    return pc.id;\n  });\n});\nexports.selectAllActiveChannelIds = selectAllActiveChannelIds;\nvar selectAllActiveChannelIdsByType = (0, _toolkit.createSelector)(selectAllChannels, function (_, type) {\n  return type;\n}, function (channels, type) {\n  return channels.filter(function (pc) {\n    return pc.type === type && (pc.state === channel_states.OPEN || pc.state === channel_states.BACKGROUND);\n  }).map(function (pc) {\n    return pc.id;\n  });\n});\nexports.selectAllActiveChannelIdsByType = selectAllActiveChannelIdsByType;\nvar _default = channelSlice.reducer;\nexports.default = _default;","map":{"version":3,"names":["channel_types","channel_states","channelsAdapter","createEntityAdapter","initialState","getInitialState","displayChannelType","SINGLE","myChannelIds","GROUP","STAR","channelSlice","createSlice","name","reducers","addChannel","state","action","addOne","updateChannel","updateOne","closeChannel","payload","channelId","background","id","changes","BACKGROUND","CLOSED","removeChannel","removeOne","setMyChannel","channelType","setDisplayChannelType","actions","getSelectors","channels","selectChannelById","selectById","selectAllChannels","selectAll","selectAllChannelIds","selectIds","selectAllActiveChannelIds","createSelector","_","type","filter","pc","map","selectAllActiveChannelIdsByType","OPEN","reducer"],"sources":["/home/ali/Desktop/brightid/BrightID/BrightID/src/components/PendingConnections/channelSlice.ts"],"sourcesContent":["import {\n  createSelector,\n  createSlice,\n  createEntityAdapter,\n  PayloadAction,\n  Update,\n} from '@reduxjs/toolkit';\n\nimport { Draft } from 'immer';\n/*\n\n  What is a channel:\n  - 'aesKey': encryption key for data transported through channel\n  - 'api': instance of ChannelAPI for this channel\n  - 'id': unique identifier\n  - 'initiatorProfileId': profileId of channel initiator\n  - 'myProfileId': my profileId in this channel\n  - 'pollTimerId: IntervalId of timer polling for incoming connection requests from this channel\n  - 'state': state of channel - see channel_states below\n  - 'timestamp': timestamp of channel creation time\n  - 'ttl': time to live of channel (seconds)\n  - 'type': group or 1:1 connection - see channel_types below\n  - 'timeoutId: Id of timer to expire channel once ttl is reached\n  - 'url': url of channel\n\n  The app could hold multiple channels at the same time. E.g. if i scan multiple QRCodes\n  in a larger group session.\n\n */\n\nexport enum channel_types {\n  GROUP = 'GROUP',\n  SINGLE = 'SINGLE',\n  STAR = 'STAR',\n}\n\nexport enum channel_states {\n  OPEN = 'OPEN',\n  CLOSED = 'CLOSED',\n  BACKGROUND = 'BACKGROUND',\n}\n\nexport const channelsAdapter = createEntityAdapter<Channel>();\n\nconst initialState = channelsAdapter.getInitialState<DisplayChannel>({\n  displayChannelType: channel_types.SINGLE,\n  myChannelIds: {\n    [channel_types.SINGLE]: '',\n    [channel_types.GROUP]: '',\n    [channel_types.STAR]: '',\n  },\n});\n\nconst channelSlice = createSlice({\n  name: 'channels',\n  initialState,\n  reducers: {\n    addChannel(state: Draft<ChannelsState>, action: PayloadAction<Channel>) {\n      state = channelsAdapter.addOne<ChannelsState>(\n        state as ChannelsState,\n        action,\n      );\n    },\n    // addChannel: channelsAdapter.addOne,\n    updateChannel(\n      state: Draft<ChannelsState>,\n      action: PayloadAction<Update<Channel>>,\n    ) {\n      state = channelsAdapter.updateOne<ChannelsState>(\n        state as ChannelsState,\n        action,\n      );\n    },\n    closeChannel(\n      state: Draft<ChannelsState>,\n      action: PayloadAction<{ channelId: string; background: boolean }>,\n    ) {\n      const { channelId, background } = action.payload;\n      state = channelsAdapter.updateOne<ChannelsState>(state as ChannelsState, {\n        id: channelId,\n        changes: {\n          state: background ? channel_states.BACKGROUND : channel_states.CLOSED,\n        },\n      });\n      if (state.myChannelIds[channel_types.SINGLE] === channelId)\n        state.myChannelIds[channel_types.SINGLE] = '';\n\n      if (state.myChannelIds[channel_types.GROUP] === channelId)\n        state.myChannelIds[channel_types.GROUP] = '';\n\n      if (state.myChannelIds[channel_types.STAR] === channelId)\n        state.myChannelIds[channel_types.STAR] = '';\n    },\n    removeChannel(state: Draft<ChannelsState>, action: PayloadAction<string>) {\n      const channelId = action.payload;\n      state = channelsAdapter.removeOne<ChannelsState>(\n        state as ChannelsState,\n        channelId,\n      );\n      // In case my channel got removed also clear myChannelId\n      if (state.myChannelIds[channel_types.SINGLE] === channelId)\n        state.myChannelIds[channel_types.SINGLE] === '';\n\n      if (state.myChannelIds[channel_types.GROUP] === channelId)\n        state.myChannelIds[channel_types.GROUP] === '';\n\n      if (state.myChannelIds[channel_types.STAR] === channelId)\n        state.myChannelIds[channel_types.STAR] = '';\n    },\n    setMyChannel(\n      state: Draft<ChannelsState>,\n      action: PayloadAction<{ channelType: ChannelType; channelId: string }>,\n    ) {\n      const { channelType, channelId } = action.payload;\n      state.myChannelIds[channelType] = channelId;\n    },\n    setDisplayChannelType(\n      state: Draft<ChannelsState>,\n      action: PayloadAction<ChannelType>,\n    ) {\n      const channelType = action.payload;\n      state.displayChannelType = channelType;\n    },\n  },\n});\n\n// Export channel actions\nexport const {\n  addChannel,\n  updateChannel,\n  removeChannel,\n  setMyChannel,\n  closeChannel,\n  setDisplayChannelType,\n} = channelSlice.actions;\n\n// Export channel selectors\nexport const {\n  selectById: selectChannelById,\n  selectAll: selectAllChannels,\n  selectIds: selectAllChannelIds,\n} = channelsAdapter.getSelectors((state: State) => state.channels);\n\n// additional selectors\nexport const selectAllActiveChannelIds = createSelector(\n  selectAllChannels,\n  // check to see if this is state or channel state\n  (_: State, type: ChannelType) => type,\n  (channels, type) =>\n    channels.filter((pc) => pc.type === type).map((pc) => pc.id),\n);\n\nexport const selectAllActiveChannelIdsByType = createSelector(\n  selectAllChannels,\n  (_: State, type: ChannelType) => type,\n  (channels, type) =>\n    channels\n      .filter(\n        (pc) =>\n          pc.type === type &&\n          (pc.state === channel_states.OPEN ||\n            pc.state === channel_states.BACKGROUND),\n      )\n      .map((pc) => pc.id),\n);\n\n// Export reducer\nexport default channelSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}