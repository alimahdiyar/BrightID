{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport store from \"../store\";\nimport { createSelector } from '@reduxjs/toolkit';\nimport { selectAllConnections, selectConnectionById } from \"../reducer/connectionsSlice\";\n\nvar threeKnownMembers = function threeKnownMembers(group) {\n  var _store$getState = store.getState(),\n      _store$getState$user = _store$getState.user,\n      id = _store$getState$user.id,\n      photo = _store$getState$user.photo,\n      name = _store$getState$user.name;\n\n  var connections = selectAllConnections(store.getState());\n  var members = group.members;\n  var connsWithMe = [].concat(_toConsumableArray(connections), [{\n    photo: photo,\n    name: name,\n    id: id\n  }]);\n  return members.map(function (u) {\n    return connsWithMe.find(function (conn) {\n      return conn.id === u;\n    });\n  }).filter(function (u) {\n    return u;\n  }).sort(function (u1) {\n    return group.admins.includes(u1.id) ? -1 : 1;\n  }).slice(0, 3);\n};\n\nexport var groupCirclePhotos = function groupCirclePhotos(group) {\n  return threeKnownMembers(group).map(function (member) {\n    return {\n      photo: member.photo\n    };\n  });\n};\nexport var getGroupName = function getGroupName(group) {\n  return (group == null ? void 0 : group.name) || threeKnownMembers(group).map(function (member) {\n    return member.name.substr(0, 13);\n  }).join(', ');\n};\nexport var ids2connections = function ids2connections(ids) {\n  var _store$getState2 = store.getState(),\n      _store$getState2$user = _store$getState2.user,\n      name = _store$getState2$user.name,\n      id = _store$getState2$user.id,\n      photo = _store$getState2$user.photo;\n\n  return ids.map(function (_id) {\n    if (_id === id) {\n      return {\n        id: id,\n        name: name,\n        photo: photo\n      };\n    }\n\n    var conn = selectConnectionById(store.getState(), _id);\n\n    if (conn) {\n      return conn;\n    } else {\n      return {\n        id: _id,\n        name: 'Stranger'\n      };\n    }\n  });\n};\nexport var knownMemberIDs = function knownMemberIDs(group) {\n  return group.members.filter(function (memberId) {\n    return selectConnectionById(store.getState(), memberId);\n  });\n};\nexport var groupByIdSelector = createSelector(function (state) {\n  return state.groups.groups;\n}, function (_, groupId) {\n  return groupId;\n}, function (groups, groupId) {\n  var group = groups.find(function (group) {\n    return group.id === groupId;\n  });\n  return {\n    group: group,\n    admins: group ? group.admins : [],\n    members: group ? group.members : []\n  };\n});","map":{"version":3,"names":["store","createSelector","selectAllConnections","selectConnectionById","threeKnownMembers","group","getState","user","id","photo","name","connections","members","connsWithMe","map","u","find","conn","filter","sort","u1","admins","includes","slice","groupCirclePhotos","member","getGroupName","substr","join","ids2connections","ids","_id","knownMemberIDs","memberId","groupByIdSelector","state","groups","_","groupId"],"sources":["/home/ali/Desktop/brightid/BrightID/BrightID/src/utils/groups.ts"],"sourcesContent":["import store, {RootState} from '@/store';\nimport {createSelector} from '@reduxjs/toolkit';\nimport {selectAllConnections, selectConnectionById,} from '@/reducer/connectionsSlice';\n\nconst threeKnownMembers = (group: Group): Array<Connection> => {\n  const {\n    user: { id, photo, name },\n  } = store.getState();\n  const connections = selectAllConnections(store.getState());\n  const { members } = group;\n  const connsWithMe = [\n    ...connections,\n    {\n      photo,\n      name,\n      id,\n    },\n  ];\n  return members\n    .map((u) => connsWithMe.find((conn) => conn.id === u))\n    .filter((u) => u)\n    .sort((u1) => (group.admins.includes(u1.id) ? -1 : 1))\n    .slice(0, 3);\n};\n\nexport const groupCirclePhotos = (group: Group) => {\n  return threeKnownMembers(group).map((member) => {\n    return { photo: member.photo };\n  });\n};\n\nexport const getGroupName = (group: Group) => {\n  return (\n    group?.name ||\n    threeKnownMembers(group)\n      .map((member) => member.name.substr(0, 13))\n      .join(', ')\n  );\n};\n\nexport const ids2connections = (ids: Array<string>): Array<Connection> => {\n  const {\n    user: { name, id, photo },\n  } = store.getState();\n\n  return ids.map((_id) => {\n    if (_id === id) {\n      return { id, name, photo };\n    }\n    const conn = selectConnectionById(store.getState(), _id);\n    if (conn) {\n      return conn;\n    } else {\n      return { id: _id, name: 'Stranger' };\n    }\n  });\n};\n\nexport const knownMemberIDs = (group: Group) => {\n  // only members that are in my connections are known\n  return group.members.filter((memberId) =>\n    selectConnectionById(store.getState(), memberId),\n  );\n};\n\nexport const groupByIdSelector = createSelector(\n  (state: RootState) => state.groups.groups,\n  (_, groupId: string) => groupId,\n  (groups: Group[], groupId: string) => {\n    const group = groups.find((group) => group.id === groupId);\n    return {\n      group,\n      admins: group ? group.admins : [],\n      members: group ? group.members : [],\n    };\n  },\n);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}