{"ast":null,"code":"function _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nimport { setActiveNotification } from \"../../actions\";\nimport { MISC_TYPE } from \"../../utils/constants\";\nimport { createSlice, createSelector } from '@reduxjs/toolkit';\nimport i18next from 'i18next';\nimport { UserTasks } from \"./UserTasks\";\nvar initialState = {};\nvar tasksSlice = createSlice({\n  name: 'tasks',\n  initialState: initialState,\n  reducers: {\n    addTask: function addTask(state, action) {\n      var taskId = action.payload;\n\n      if (!(taskId in state)) {\n        state[taskId] = {\n          id: taskId,\n          completed: false,\n          timestamp: 0\n        };\n      }\n    },\n    removeTask: function removeTask(state, action) {\n      var taskId = action.payload;\n\n      if (taskId in state) {\n        delete state[taskId];\n      }\n    },\n    resetTask: function resetTask(state, action) {\n      var taskId = action.payload;\n\n      if (taskId in state) {\n        state[taskId].completed = false;\n        state[taskId].timestamp = 0;\n      }\n    },\n    completeTask: function completeTask(state, action) {\n      var taskId = action.payload;\n      var task = state[taskId];\n\n      if (task) {\n        task.completed = true;\n        task.timestamp = Date.now();\n      } else {\n        console.log(\"completeTask() called for unknown task \" + taskId);\n      }\n    }\n  },\n  extraReducers: {\n    RESET_STORE: function RESET_STORE(state) {\n      for (var _i = 0, _Object$values = Object.values(state); _i < _Object$values.length; _i++) {\n        var task = _Object$values[_i];\n        task.completed = false;\n        task.timestamp = 0;\n      }\n    }\n  }\n});\nvar _tasksSlice$actions = tasksSlice.actions,\n    addTask = _tasksSlice$actions.addTask,\n    removeTask = _tasksSlice$actions.removeTask,\n    completeTask = _tasksSlice$actions.completeTask,\n    resetTask = _tasksSlice$actions.resetTask;\nexport { addTask, removeTask, completeTask, resetTask };\nexport var syncStoreTasks = function syncStoreTasks() {\n  return function (dispatch, getState) {\n    var userTaskIds = Object.keys(UserTasks);\n    var storeTaskIds = Object.keys(getState().tasks);\n    var idsToRemove = storeTaskIds.filter(function (id) {\n      return !userTaskIds.includes(id);\n    });\n    var idsToAdd = userTaskIds.filter(function (id) {\n      return !storeTaskIds.includes(id);\n    });\n\n    for (var _iterator = _createForOfIteratorHelperLoose(idsToRemove), _step; !(_step = _iterator()).done;) {\n      var id = _step.value;\n\n      if (id !== '_persist') {\n        console.log(\"Removing task \" + id + \" from store\");\n        dispatch(removeTask(id));\n      }\n    }\n\n    for (var _iterator2 = _createForOfIteratorHelperLoose(idsToAdd), _step2; !(_step2 = _iterator2()).done;) {\n      var _id = _step2.value;\n      console.log(\"Adding task \" + _id + \" to store\");\n      dispatch(addTask(_id));\n    }\n  };\n};\nexport var checkTasks = function checkTasks() {\n  return function (dispatch, getState) {\n    var state = getState();\n\n    for (var _i2 = 0, _Object$values2 = Object.values(state.tasks); _i2 < _Object$values2.length; _i2++) {\n      var task = _Object$values2[_i2];\n\n      if (UserTasks[task.id]) {\n        try {\n          var completed = UserTasks[task.id].checkFn(state);\n\n          if (completed && !state.tasks[task.id].completed) {\n            console.log(\"Task '\" + UserTasks[task.id].title + \"' completed.\");\n            dispatch(completeTask(task.id));\n            dispatch(setActiveNotification({\n              type: MISC_TYPE,\n              title: i18next.t('achievements.notification.title'),\n              message: i18next.t('achievements.notification.message', {\n                title: UserTasks[task.id].title\n              }),\n              navigationTarget: null,\n              icon: 'Certificate'\n            }));\n          } else if (!completed && state.tasks[task.id].completed) {\n            console.log(\"Task '\" + UserTasks[task.id].title + \"' reset.\");\n            dispatch(resetTask(task.id));\n          }\n        } catch (err) {\n          console.log(\"Error while checking task \" + task.id + \": \" + err.message);\n        }\n      }\n    }\n  };\n};\nexport default tasksSlice.reducer;\nexport var selectTaskIds = createSelector(function (state) {\n  return state.tasks;\n}, function (tasks) {\n  return Object.keys(tasks).filter(function (id) {\n    return id !== '_persist';\n  }).sort(function (a, b) {\n    return UserTasks[a].sortValue - UserTasks[b].sortValue;\n  });\n});\nexport var selectCompletedTaskIds = createSelector(selectTaskIds, function (state) {\n  return state.tasks;\n}, function (taskIds, tasks) {\n  return taskIds.filter(function (taskId) {\n    return tasks[taskId].completed;\n  });\n});","map":{"version":3,"sources":["/home/ali/Desktop/brightid/BrightID/BrightID/src/components/Tasks/TasksSlice.ts"],"names":["initialState","tasksSlice","createSlice","name","reducers","addTask","taskId","action","state","id","completed","timestamp","removeTask","resetTask","completeTask","task","Date","console","extraReducers","RESET_STORE","Object","syncStoreTasks","userTaskIds","storeTaskIds","getState","idsToRemove","idsToAdd","dispatch","checkTasks","UserTasks","setActiveNotification","type","title","i18next","message","navigationTarget","icon","err","selectTaskIds","createSelector","selectCompletedTaskIds","taskIds","tasks"],"mappings":"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","sourcesContent":["import { setActiveNotification } from '@/actions';\nimport { MISC_TYPE } from '@/utils/constants';\nimport { createSlice, createSelector } from '@reduxjs/toolkit';\nimport i18next from 'i18next';\nimport { UserTasks } from './UserTasks';\n\n/*\n  Reducer tracking tasks completion. Stores taskID, completion status and timestamp of completion.\n\n  The actual task definitions (id, title, description and validation method) are located in\n  file UserTasks.js. At app startup (bootstrap.js) the ids of new tasks are loaded from\n  UserTasks.js and added to the redux store.\n\n  Example for two tasks:\n   - task with ID 'taskID1' that has been completed on August 10th (timestamp 1597064209249)\n   - task with ID 'taskID2' is not yet completed\n\n  state = {\n    'taskID1': {\n      id: 'taskID1',\n      completed: true,\n      timestamp: 1597064209249\n    }\n    'taskID2': {\n      id: 'taskID2',\n      completed: false,\n      timestamp: 0,\n    }\n  }\n\n */\nconst initialState: TasksState = {};\n\nconst tasksSlice = createSlice({\n  name: 'tasks',\n  initialState,\n  reducers: {\n    addTask(state, action) {\n      const taskId = action.payload;\n      // only add tasks that are not yet known\n      if (!(taskId in state)) {\n        state[taskId] = {\n          id: taskId,\n          completed: false,\n          timestamp: 0,\n        };\n      }\n    },\n    removeTask(state, action) {\n      const taskId = action.payload;\n      if (taskId in state) {\n        delete state[taskId];\n      }\n    },\n    resetTask(state, action) {\n      const taskId = action.payload;\n      if (taskId in state) {\n        state[taskId].completed = false;\n        state[taskId].timestamp = 0;\n      }\n    },\n    completeTask(state, action) {\n      const taskId = action.payload;\n      const task = state[taskId];\n      if (task) {\n        task.completed = true;\n        task.timestamp = Date.now();\n      } else {\n        console.log(`completeTask() called for unknown task ${taskId}`);\n      }\n    },\n  },\n  extraReducers: {\n    RESET_STORE: (state) => {\n      for (const task of Object.values(state)) {\n        task.completed = false;\n        task.timestamp = 0;\n      }\n    },\n  },\n});\n\nexport const {\n  addTask,\n  removeTask,\n  completeTask,\n  resetTask,\n} = tasksSlice.actions;\n\n// UserTasks.js may have tasks added or removed with an app update. This action takes care\n// that the persisted store always is up to date with the available tasks.\nexport const syncStoreTasks = () => {\n  return (dispatch: dispatch, getState: getState) => {\n    const userTaskIds = Object.keys(UserTasks);\n    const storeTaskIds = Object.keys(getState().tasks);\n    const idsToRemove = storeTaskIds.filter((id) => !userTaskIds.includes(id));\n    const idsToAdd = userTaskIds.filter((id) => !storeTaskIds.includes(id));\n    for (const id of idsToRemove) {\n      if (id !== '_persist') {\n        console.log(`Removing task ${id} from store`);\n        dispatch(removeTask(id));\n      }\n    }\n    for (const id of idsToAdd) {\n      console.log(`Adding task ${id} to store`);\n      dispatch(addTask(id));\n    }\n  };\n};\n\nexport const checkTasks = () => {\n  return (dispatch: dispatch, getState: getState) => {\n    const state = getState();\n    for (const task of Object.values(state.tasks)) {\n      if (UserTasks[task.id]) {\n        try {\n          const completed = UserTasks[task.id].checkFn(state);\n          if (completed && !state.tasks[task.id].completed) {\n            console.log(`Task '${UserTasks[task.id].title}' completed.`);\n            dispatch(completeTask(task.id));\n            dispatch(\n              setActiveNotification({\n                type: MISC_TYPE,\n                title: i18next.t('achievements.notification.title'),\n                message: i18next.t('achievements.notification.message', {\n                  title: UserTasks[task.id].title,\n                }),\n                navigationTarget: null,\n                icon: 'Certificate',\n              }),\n            );\n          } else if (!completed && state.tasks[task.id].completed) {\n            console.log(`Task '${UserTasks[task.id].title}' reset.`);\n            dispatch(resetTask(task.id));\n          }\n        } catch (err) {\n          console.log(`Error while checking task ${task.id}: ${err.message}`);\n        }\n      }\n    }\n  };\n};\n\nexport default tasksSlice.reducer;\n\nexport const selectTaskIds = createSelector(\n  (state: State) => state.tasks,\n  (tasks) => {\n    return Object.keys(tasks)\n      .filter((id) => id !== '_persist')\n      .sort((a, b) => UserTasks[a].sortValue - UserTasks[b].sortValue);\n  },\n);\n\nexport const selectCompletedTaskIds = createSelector(\n  selectTaskIds,\n  (state: State) => state.tasks,\n  (taskIds, tasks) =>\n    taskIds.filter((taskId: string) => tasks[taskId].completed),\n);\n"]},"metadata":{},"sourceType":"module"}